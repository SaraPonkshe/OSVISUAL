<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Allocation Game</title>
<style>
body {
  font-family: "Poppins", sans-serif;
  background: radial-gradient(circle at top, #0b0b0b, #000);
  color: #eee;
  text-align: center;
  padding: 20px;
}
h1 {
  color: #00d4ff;
  text-shadow: 0 0 8px #00d4ff;
  margin-bottom: 20px;
}
.input-box {
  background: rgba(25,25,25,0.9);
  padding: 20px;
  border-radius: 12px;
  display: inline-block;
  border: 1px solid #00d4ff44;
  box-shadow: 0 0 15px rgba(0,212,255,0.2);
  margin-bottom: 25px;
}
select, input, button {
  margin: 6px;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #00d4ff55;
  background: #111;
  color: white;
}
button {
  cursor: pointer;
  background: linear-gradient(90deg,#00d4ff,#00ffaa);
  color: #000;
  font-weight: bold;
  transition: 0.3s;
}
button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 10px #00ffaa77;
}

#memory {
  display: flex;
  flex-direction: column; /* vertical layout */
  justify-content: flex-start;
  align-items: center;
  margin: 20px auto;
  max-width: 200px;
}
.mem-block {
  width: 120px;
  height: 80px;
  margin: 5px 0;
  border-radius: 6px;
  background-color: #111;
  border: 2px solid #00d4ff;
  color: #eee;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  cursor: pointer;
  transition: transform 0.2s, background 0.3s;
}
.mem-block:hover {
  transform: scale(1.05);
}

.process-selector {
  margin: 10px;
}

#feedback {
  font-size: 18px;
  font-weight: bold;
  margin-top: 15px;
}
#finalMsg {
  font-size: 20px;
  color: #00ffaa;
  font-weight: bold;
  margin-top: 20px;
  text-shadow: 0 0 8px #00ffaa;
}
</style>
</head>
<body>

<h1>MEMORY ALLOCATON</h1>

<div class="input-box">
  <label><b>Algorithm:</b></label>
  <select id="algorithm">
    <option value="FirstFit">First Fit</option>
    <option value="BestFit">Best Fit</option>
    <option value="WorstFit">Worst Fit</option>
  </select>
  <br>
  <label><b>No. of Memory Blocks:</b></label>
  <input type="number" id="numBlocks" value="5" min="3" max="8">
  <br>
  <label><b>No. of Processes:</b></label>
  <input type="number" id="numProcesses" value="4" min="2" max="6">
  <br>
  <button onclick="startGame()">Generate Random Problem</button>
</div>

<div id="memory"></div>
<div id="processSelector" class="process-selector"></div>
<p id="feedback"></p>
<p id="finalMsg"></p>
<button onclick="replaySimulation()" id="replayBtn" style="display:none;">‚ñ∂ Watch Correct Allocation</button>
<button onclick="checkAnswer()">Submit Allocation</button>

<script>
let memoryBlocks = [];
let processes = [];
let selectedProcess = null;
let algorithm = "FirstFit";
let correctAllocation = [];

function startGame(){
  algorithm = document.getElementById("algorithm").value;
  const numBlocks = parseInt(document.getElementById("numBlocks").value);
  const numProcesses = parseInt(document.getElementById("numProcesses").value);

  // Generate random memory blocks
  memoryBlocks = [];
  for(let i=0;i<numBlocks;i++){
    memoryBlocks.push({size: Math.floor(Math.random()*20)+10, allocated:-1});
  }

  // Generate random processes
  processes = [];
  for(let i=0;i<numProcesses;i++){
    processes.push({pid:"P"+(i+1),size:Math.floor(Math.random()*15)+5});
  }

  selectedProcess=null;
  renderMemory();
  renderProcessSelector();
  document.getElementById("feedback").textContent="";
  document.getElementById("finalMsg").textContent="";
  document.getElementById("replayBtn").style.display="none";

  computeCorrectAllocation();
}

function renderMemory(){
  const memDiv = document.getElementById("memory");
  memDiv.innerHTML="";
  memoryBlocks.forEach((block,i)=>{
    const div = document.createElement("div");
    div.className="mem-block";
    div.dataset.index=i;
    const colors = ["#111","#00ffaa","#ffaa00","#ff5555","#55ff55","#aa00ff"];
    const bgColor = block.allocated===-1?"#111":colors[block.allocated+1];
    div.style.background = bgColor;
    div.innerHTML=`Block ${i+1}<br>Size:${block.size}<br>${block.allocated==-1?"Free":processes[block.allocated].pid}`;
    div.onclick = ()=>allocateProcess(i);
    memDiv.appendChild(div);
  });
}

function renderProcessSelector(){
  const selDiv = document.getElementById("processSelector");
  selDiv.innerHTML="<b>Select Process:</b> ";
  processes.forEach((p,i)=>{
    const btn = document.createElement("button");
    btn.textContent=p.pid+"("+p.size+")";
    btn.onclick=()=>{selectedProcess=i; highlightSelected(btn)};
    selDiv.appendChild(btn);
  });
}

function highlightSelected(btn){
  [...document.getElementById("processSelector").children].forEach(b=>b.style.border="1px solid #00d4ff");
  btn.style.border="2px solid #00ffaa";
}

function allocateProcess(blockIndex){
  if(selectedProcess===null) return;
  if(memoryBlocks[blockIndex].allocated!==-1){
    document.getElementById("feedback").textContent="‚ùå Block already allocated!";
    return;
  }
  if(memoryBlocks[blockIndex].size<processes[selectedProcess].size){
    document.getElementById("feedback").textContent="‚ùå Process does not fit!";
    return;
  }
  memoryBlocks[blockIndex].allocated = selectedProcess;
  renderMemory();
}

function computeCorrectAllocation(){
  correctAllocation = memoryBlocks.map(()=>-1);
  const memCopy = memoryBlocks.map(b=>b.size);
  processes.forEach((p,i)=>{
    if(algorithm=="FirstFit"){
      for(let j=0;j<memCopy.length;j++){
        if(memCopy[j]>=p.size && correctAllocation[j]==-1){
          correctAllocation[j]=i;
          memCopy[j]-=p.size;
          break;
        }
      }
    } else if(algorithm=="BestFit"){
      let best=-1, bestSize=Infinity;
      for(let j=0;j<memCopy.length;j++){
        if(memCopy[j]>=p.size && correctAllocation[j]==-1 && memCopy[j]<bestSize){
          best=j;
          bestSize=memCopy[j];
        }
      }
      if(best!=-1){correctAllocation[best]=i; memCopy[best]-=p.size;}
    } else if(algorithm=="WorstFit"){
      let worst=-1, worstSize=-1;
      for(let j=0;j<memCopy.length;j++){
        if(memCopy[j]>=p.size && correctAllocation[j]==-1 && memCopy[j]>worstSize){
          worst=j;
          worstSize=memCopy[j];
        }
      }
      if(worst!=-1){correctAllocation[worst]=i; memCopy[worst]-=p.size;}
    }
  });
}

function checkAnswer(){
  let correct=true;
  for(let i=0;i<memoryBlocks.length;i++){
    if(memoryBlocks[i].allocated!==correctAllocation[i]){
      correct=false;
      document.getElementById("memory").children[i].style.border="2px solid red";
    } else {
      document.getElementById("memory").children[i].style.border="2px solid #00d4ff";
    }
  }
  const fb=document.getElementById("feedback");
  if(correct){
    fb.textContent="‚úÖ You solved correctly!";
  } else {
    fb.textContent="‚ùå Wrong answer. Watch simulation for correct allocation.";
  }
  document.getElementById("replayBtn").style.display="inline-block";
}

async function replaySimulation(){
  memoryBlocks.forEach((b,i)=>b.allocated=-1);
  renderMemory();
  const colors = ["#111","#00ffaa","#ffaa00","#ff5555","#55ff55","#aa00ff"];
  for(let i=0;i<correctAllocation.length;i++){
    if(correctAllocation[i]!==-1){
      memoryBlocks[i].allocated=correctAllocation[i];
      renderMemory();
      await new Promise(res=>setTimeout(res,500));
    }
  }
  document.getElementById("feedback").textContent="üé¨ Simulation Complete!";
  document.getElementById("finalMsg").textContent=`Algorithm: ${algorithm}`;
}
</script>
</body>
</html>
