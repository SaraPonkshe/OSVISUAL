<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BANKER'S ALGORITHM</title>
<style>
  body {
    background: radial-gradient(circle at top, #0b0b0b, #000);
    color: #f5f5f5;
    font-family: "Poppins", sans-serif;
    padding: 20px;
  }
  h1 {
    color: #00e0ff;
    text-align: center;
    text-shadow: 0 0 8px #00e0ff;
  }
  .panel {
    background: rgba(30,30,30,0.95);
    border-radius: 12px;
    padding: 15px;
    margin: 15px auto;
    max-width: 900px;
    border: 1px solid #00e0ff33;
    box-shadow: 0 0 12px rgba(0,224,255,0.2);
  }
  input {
    background: #111;
    color: #fff;
    border: 1px solid #555;
    border-radius: 6px;
    padding: 5px 8px;
    width: 60px;
  }
  button {
    background: linear-gradient(90deg,#00e0ff,#00ff88);
    border: none;
    color: #000;
    font-weight: 600;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    margin: 5px;
    transition: 0.3s;
  }
  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 12px #00ff88;
  }
  button.ghost {
    background: transparent;
    border: 1px solid #666;
    color: #fff;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th,td {
    border: 1px solid #444;
    padding: 5px;
    text-align: center;
  }
  th { color: #00e0ff; }
  .available {
    margin-top: 8px;
    background: #1e1e1e;
    padding: 8px;
    border-radius: 8px;
    color: #00ff88;
    font-weight: bold;
  }
  .proc-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  .proc {
    background: #2e2e2e;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    transition: 0.3s;
  }
  .proc:hover {
    transform: scale(1.1);
    background: #00e0ff33;
  }
  .proc.done {
    background: #00ff88;
    color: #000;
    box-shadow: 0 0 8px #00ff88;
  }
  .proc.active {
    background: #00e0ff;
    color: #000;
    box-shadow: 0 0 12px #00e0ff;
    transform: scale(1.1);
  }
  .log {
    background: #111;
    padding: 10px;
    border-radius: 8px;
    min-height: 40px;
    margin-top: 10px;
    transition: 0.3s;
  }
  .result {
    text-align: center;
    font-weight: 700;
    border-radius: 8px;
    padding: 8px;
    margin-top: 10px;
  }
  .correct { background: #00ff88; color: #000; }
  .wrong { background: #ff6b6b; }
</style>
</head>
<body>

<h1>BANKER'S ALGORITHM</h1>

<div class="panel">
  <label>Processes: <input id="numP" type="number" min="2" max="6" value="3"></label>
  <label>Resources: <input id="numR" type="number" min="1" max="6" value="3"></label>
  <button id="generate">Generate Problem</button>
</div>

<div class="panel" id="problemArea"></div>

<div class="panel">
  <h3>Select Process Order</h3>
  <div id="processBtns" class="proc-buttons"></div>
  <button id="submit">Submit</button>
  <button id="showSimulation" class="ghost" style="display:none;">â–¶ Watch Correct Simulation</button>
  <div class="log" id="log"></div>
  <div class="result" id="result"></div>
</div>

<script>
let Allocation=[], Max=[], Need=[], Available=[], safeSeq=[];
let P=3,R=3, chosenSeq=[];
const problemArea=document.getElementById('problemArea');
const processBtns=document.getElementById('processBtns');
const logDiv=document.getElementById('log');
const resultDiv=document.getElementById('result');
const showSimBtn=document.getElementById('showSimulation');

document.getElementById('generate').onclick=generateProblem;
document.getElementById('submit').onclick=checkSequence;
showSimBtn.onclick=showSimulation;

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

function generateProblem(){
  P=+document.getElementById('numP').value;
  R=+document.getElementById('numR').value;
  Allocation=Array.from({length:P},()=>Array.from({length:R},()=>rand(0,3)));
  Max=Array.from({length:P},()=>Array.from({length:R},(_,j)=>Allocation[0][j]+rand(1,3)));
  Need=Allocation.map((row,i)=>row.map((v,j)=>Max[i][j]-v));
  Available=Array.from({length:R},()=>rand(3,6));
  safeSeq=findSafeSequence();
  chosenSeq=[];
  renderTables();
  renderButtons();
  resultDiv.innerHTML='';
  log("ðŸ§© Problem generated. Choose process order.");
  showSimBtn.style.display='none';
}

function renderTables(){
  let html=`<table><tr><th>Process</th>`;
  for(let j=0;j<R;j++)html+=`<th>Alloc${j}</th>`;
  for(let j=0;j<R;j++)html+=`<th>Max${j}</th>`;
  for(let j=0;j<R;j++)html+=`<th>Need${j}</th>`;
  html+=`</tr>`;
  for(let i=0;i<P;i++){
    html+=`<tr><td>P${i}</td>`;
    for(let j=0;j<R;j++)html+=`<td>${Allocation[i][j]}</td>`;
    for(let j=0;j<R;j++)html+=`<td>${Max[i][j]}</td>`;
    for(let j=0;j<R;j++)html+=`<td>${Need[i][j]}</td>`;
    html+=`</tr>`;
  }
  html+=`</table><div class="available"><b>Available:</b> ${Available.join(', ')}</div>`;
  problemArea.innerHTML=html;
}

function renderButtons(){
  processBtns.innerHTML='';
  for(let i=0;i<P;i++){
    const div=document.createElement('div');
    div.className='proc';
    div.innerText=`P${i}`;
    div.onclick=()=>selectProcess(i,div);
    processBtns.appendChild(div);
  }
}

function selectProcess(i,btn){
  if(chosenSeq.includes(i))return;
  chosenSeq.push(i);
  btn.classList.add('done');
  log(`âœ” Selected P${i}`);
}

function log(msg){logDiv.innerText=msg;}

function findSafeSequence(){
  let work=[...Available];
  let finish=Array(P).fill(false);
  let seq=[];
  let progress;
  do{
    progress=false;
    for(let i=0;i<P;i++){
      if(!finish[i] && Need[i].every((n,j)=>n<=work[j])){
        for(let j=0;j<R;j++)work[j]+=Allocation[i][j];
        finish[i]=true;seq.push(i);progress=true;
      }
    }
  }while(progress);
  return seq.length===P?seq:[];
}

function checkSequence(){
  if(chosenSeq.length!==P){log("âš  Select all processes!");return;}
  if(safeSeq.length===0){log("âŒ No safe sequence exists!");return;}
  const isCorrect=JSON.stringify(chosenSeq)===JSON.stringify(safeSeq);
  if(isCorrect){
    resultDiv.className='result correct';
    resultDiv.innerText="âœ… Correct Answer! Safe sequence: "+safeSeq.map(p=>'P'+p).join(' â†’ ');
  }else{
    resultDiv.className='result wrong';
    resultDiv.innerText="âŒ Wrong Sequence!";
    showSimBtn.style.display='inline-block';
  }
}

async function showSimulation(){
  showSimBtn.style.display='none';
  log("ðŸŽ¬ Starting simulation...");
  let work=[...Available];
  for(let p of safeSeq){
    let procEl=[...document.querySelectorAll('.proc')][p];
    procEl.classList.add('active');
    log(`ðŸŒ€ Executing P${p}...`);
    await new Promise(r=>setTimeout(r,1000));
    for(let j=0;j<R;j++)work[j]+=Allocation[p][j];
    log(`âœ… P${p} finished. Available: ${work.join(', ')}`);
    procEl.classList.remove('active');
    procEl.classList.add('done');
    await new Promise(r=>setTimeout(r,700));
  }
  resultDiv.className='result correct';
  resultDiv.innerText="ðŸŽ¯ Correct Safe Sequence: "+safeSeq.map(p=>'P'+p).join(' â†’ ');
}
generateProblem();
</script>
</body>
</html>
